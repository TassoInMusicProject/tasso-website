<script src="/scripts/scripts-common.js"></script>

{% include_relative templates.html %}
{% include_relative listeners.html %}

<script>
// vim: ts=3


var MUSICFIELDS    = {};
var LITERARYFIELDS = {};

var RSOURCES = {};   // reverse index for source info for popups.


//////////////////////////////
//
// displayMusicPolicies -- Show music editorial policy target element.
//

function displayMusicPolicies(target) {
	PrepareGlobalTassoObjects();
	prepareRsources();
	if (!target) {
		target = "#contents";
	}
	var element = document.querySelector(target);
	if (!element) {
		console.log("Error: cannot place Music Policy content on page.");
		return;
	}
	showTab("music-heading");
	var request = new XMLHttpRequest();
	request.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			element.innerHTML = request.responseText;
			setupMusicBrowseCallbacks();
			insertCgiSearchParameters();
			fillMusicBrowsePage();
		}
	};
	request.open("GET", "music.html", true);
	request.send();
}



//////////////////////////////
//
// displayTextPolicies -- Show text editorial policy target element.
//

function displayTextPolicies(target) {
	PrepareGlobalTassoObjects();
	prepareRsources();
	if (!target) {
		target = "#contents";
	}
	var element = document.querySelector(target);
	if (!element) {
		console.log("Error: cannot place Text Policy content on page.");
		return;
	}
	showTab("text-heading");
	var request = new XMLHttpRequest();
	request.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
			element.innerHTML = request.responseText;
			setupLiteraryBrowseCallbacks();
			insertCgiSearchParameters();
			fillLiteraryBrowsePage();
		}
	};
	request.open("GET", "text.html", true);
	request.send();
}



//////////////////////////////
//
// showTab --
//

function showTab(hiid) {
	var music     = document.querySelector("#music-heading");
	var text      = document.querySelector("#text-heading");

	music.className   = hiid == "music-heading"   ? "active" : "";
	text.className    = hiid == "text-heading"    ? "active" : "";

	fillMusicBrowsePage();
	fillLiteraryBrowsePage();
}



//////////////////////////////
//
// fillMusicBrowsePage --
//

function fillMusicBrowsePage() {
	var music = document.querySelector("#music-heading");
	if (!music) {
		return;
	}
	if (!music.className.match(/active/)) {
		return;
	}

	var repertorylist = document.querySelector("select.genre");

	var searchlist = TASSODATA.SETTINGS.RIME_SETTINGS;
	if (repertorylist) {
		var gvalue = repertorylist[repertorylist.selectedIndex].value;
console.log("GENREVALUE IS ", gvalue);
		if (gvalue.match(/aminta/i)) {
			searchlist = TASSODATA.SETTINGS.AMINTA_SETTINGS.SETTING;
		} else if (gvalue.match(/gerusalemme/i)) {
			searchlist = TASSODATA.SETTINGS.GERUSALEMME_SETTINGS.SETTING;
		} else if (gvalue.match(/^rime/i)) {
			searchlist = TASSODATA.SETTINGS.RIME_SETTINGS.SETTING;
		} else if (gvalue.match(/^ecloghe/i)) {
			searchlist = ECLOGHESETTINGLIST;
		} else if (gvalue.match(/^rinaldo/i)) {
			searchlist = RINALDOSETTINGLIST;
		} else if (gvalue.match(/lagrime/i)) {
			searchlist = LAGRIMESETTINGLIST;
		} else if (gvalue.match(/torrismondo/i)) {
			searchlist = TORRISMONDOSETTINGLIST;
		} else if (gvalue.match(/conquistata/i)) {
			searchlist = CONQUISTATASETTINGLIST;
		} else if (gvalue.match(/^all/i)) {
			searchlist = ALLSETTINGLIST;
		} else {
			console.log("GENRE IS NOT YET DEALT WITH", gvalue);
		}
	}

	var works = filterMusicData(searchlist);
	var count = works.length;
	var countElement = document.querySelector("#work-count");
	if (countElement) {
		if (count == 1) {
			countElement.innerHTML = count + " entry";
		} else {
			countElement.innerHTML = count + " entries";
		}
	}
	displayMusicBrowseEntries(works);
}



//////////////////////////////
//
// fillLiteraryBrowsePage --
//

function fillLiteraryBrowsePage() {
	var event = arguments[0];

	var literary = document.querySelector("#text-heading");
	if (!literary) {
		return;
	}
	if (!literary.className.match(/active/)) {
		return;
	}

	var repertorylist = document.querySelector("select.genre");
	var searchlist = TASSODATA.VERSES.RIME_VERSES.VERSEDATA;
	var gvalue = "";

	if (repertorylist) {
		var gvalue = repertorylist[repertorylist.selectedIndex].value;
		if (gvalue.match(/aminta/i)) {
			searchlist = TASSODATA.VERSES.AMINTA_VERSES.VERSEDATA;
		} else if (gvalue.match(/gerusalemme/i)) {
			searchlist = TASSODATA.VERSES.GERUSALEMME_VERSES.VERSEDATA;
		} else if (gvalue.match(/ecloghe/i)) {
			searchlist = TASSODATA.VERSES.ECLOGHE_VERSES.VERSEDATA;
		} else if (gvalue.match(/rinaldo/i)) {
			searchlist = TASSODATA.VERSES.RINALDO_VERSES.VERSEDATA;
		} else if (gvalue.match(/lagrime/i)) {
			searchlist = TASSODATA.VERSES.LAGRIME_VERSES.VERSEDATA;
		} else if (gvalue.match(/torrismondo/i)) {
			searchlist = TASSODATA.VERSES.TORRISMONDO_VERSES.VERSEDATA;
		} else if (gvalue.match(/conquistata/i)) {
			searchlist = TASSODATA.VERSES.CONQUISTATA_VERSES.VERSEDATA;
		} else if (gvalue.match(/^rime/i)) {
			searchlist = TASSODATA.VERSES.RIME_VERSES.VERSEDATA;
		} else {
			console.log("GENRE IS NOT YET DEALT WITH", gvalue);
		}
	}

	// var works = filterLiteraryData(RIMEVERSELIST);
	var works = filterLiteraryData(searchlist);
	var count = works.length;
	var countElement = document.querySelector("#work-count");
	if (countElement) {
		if (count == 1) {
			countElement.innerHTML = count + " entry";
		} else {
			countElement.innerHTML = count + " entries";
		}
	}
	displayLiteraryBrowseEntries(works, gvalue);
}



//////////////////////////////
//
// filterMusicData --
//

function filterMusicData(entries) {
	if (!entries) {
		entries = RIMESETTINGLIST;
	}
	if (!entries) {
		return [];
	}
	if (!entries.length) {
		return [];
	}

	output = entries;

	var composerElement = document.querySelector("#browse-composer");
	var composer = "";
	if (composerElement) {
		composer = composerElement.value;
	}

	var finalElement = document.querySelector("#browse-final");
	var final = "";
	if (finalElement) {
		final = finalElement.value;
	}

	var mensurationElement = document.querySelector("#browse-mensuration");
	var mensuration = "";
	if (mensurationElement) {
		mensuration = mensurationElement.value;
	}

	var keyElement = document.querySelector("#browse-key");
	var key = "";
	if (keyElement) {
		key = keyElement.value;
	}

	var mdedicateeElement = document.querySelector("#browse-mdedicatee");
	var mdedicatee = "";
	if (mdedicateeElement) {
		mdedicatee = mdedicateeElement.value;
	}

	var titleElement = document.querySelector("#browse-title");
	var title = "";
	if (titleElement) {
		title = titleElement.value;
	}

	var locationElement = document.querySelector("#browse-location");
	var location = "";
	if (locationElement) {
		location = locationElement.value;
	}

	var yearElement = document.querySelector("#browse-year");
	var year = "";
	if (yearElement) {
		year = yearElement.value;
	}

	var publisherElement = document.querySelector("#browse-publisher");
	var publisher = "";
	if (publisherElement) {
		publisher = publisherElement.value;
	}

	var rismElement = document.querySelector("#browse-rism");
	var rism = "";
	if (rismElement) {
		rism = rismElement.value;
	}

	var ovoicesElement = document.querySelector("#browse-ovoices");
	var ovoices = "";
	if (ovoicesElement) {
		ovoices = ovoicesElement.value;
	}
	var evoicesElement = document.querySelector("#browse-evoices");
	var evoices = "";
	if (evoicesElement) {
		evoices = evoicesElement.value;
	}

	if (composer) {
		output = filterByField(output, "COMPOSER", composer);
	}

	if (final) {
		output = filterByField(output, "FINAL", final);
	}

	if (mensuration) {
		output = filterByField(output, "OMENSURATION", mensuration);
	}

	if (key) {
		output = filterByField(output, "OKEYSIG", key);
	}

	if (mdedicatee) {
		output = filterByField(output, "SRCDEDICATEE", mdedicatee);
	}

	if (title) {
		// change this to title? But there is the setting title as well.
		output = filterByField(output, "RIMETITLE", title);
	}
	if (location) {
		output = filterByField(output, "NORMLOC", location);
	}
	if (year) {
		output = filterByField(output, "PRINCEPSYEAR", year);
	}
	if (publisher) {
		output = filterByField(output, ["NORMPUBSHORT", "NORMPUB", "PRINCEPSPUB"], publisher);
	}
	if (rism) {
		output = filterByField(output, "PRINCEPSRISM", rism);
	}
	if (ovoices) {
		output = filterByField(output, "OVOICES", ovoices);
	}
	if (evoices) {
		output = filterByField(output, "EXTANTVOICES", evoices);
	}


	return output;
}



//////////////////////////////
//
// filterLiteraryData --
//

function filterLiteraryData(entries) {
	if (!entries) {
		entries = RIMEVERSELIST;
	}
	if (!entries) {
		return [];
	}
	if (!entries.length) {
		return [];
	}

	output = entries;

	var titleElement = document.querySelector("#browse-title");
	var title = "";
	if (titleElement) {
		title = titleElement.value;
	}

	var dedicateeElement = document.querySelector("#browse-dedicatee");
	var dedicatee = "";
	if (dedicateeElement) {
		dedicatee = dedicateeElement.value;
	}

	var litgenreElement = document.querySelector("#browse-litgenre");
	var litgenre = "";
	if (litgenreElement) {
		litgenre = litgenreElement.value;
	}

	var manuscriptElement = document.querySelector("#browse-manuscript");
	var manuscript = "";
	if (manuscriptElement) {
		manuscript = manuscriptElement.value;
	}

	var printElement = document.querySelector("#browse-print");
	var print = "";
	if (printElement) {
		print = printElement.value;
	}

	var publocationElement = document.querySelector("#browse-publocation");
	var publocation = "";
	if (publocationElement) {
		publocation = publocationElement.value;
	}

	var manlocationElement = document.querySelector("#browse-manlocation");
	var manlocation = "";
	if (manlocationElement) {
		manlocation = manlocationElement.value;
	}

	if (title) {
		output = filterByField(output, "TITLE", title);
	}

	if (dedicatee) {
		output = filterByField(output, "DEDICATEE", dedicatee);
	}

	if (litgenre) {
		output = filterByField(output, "GENRE", litgenre);
	}

	if (manuscript) {
		output = filterByField(output, "MANUSRC", manuscript);
	}

	if (print) {
		output = filterByField(output, "PRINTSRC", print, true);
	}

	if (publocation) {
		output = filterByField(output, "PUBLOCATION", publocation);
	}

	if (manlocation) {
		output = filterByField(output, "MANLOCATION", manlocation);
	}

	return output;
}



//////////////////////////////
//
// filterByField --
//

function filterByField(entries, field, value, bound) {
	if (!entries) {
		return [];
	}
	if (entries.length == 0) {
		return [];
	}
	var output = [];

	// fix for regular expressions:
	//value = value.replace(/'/g, "\\\'");

	if (bound) {
		value = "\\b" + value + "\\b";
	}
	var re = new RegExp(value, "i");
	for (var i=0; i<entries.length; i++) {
		if (field instanceof Array) {
			var found = 0;
			for (var j=0; j<field.length; j++) {
				if (!entries[i][field[j]]) {
					continue;
				}
				if (entries[i][field[j]].match(re)) {
					found = 1;
					break;
				}
			}
			if (found) {
				output.push(entries[i]);
			}
		} else {
			if (!entries[i][field]) {
				continue;
			}
			if (entries[i][field].match(re)) {
				output.push(entries[i]);
			}
		}
	}

	return output;
}



//////////////////////////////
//
// displayMusicBrowseEntries --
//

function displayMusicBrowseEntries(entries) {
	var element = document.querySelector("#browse-results");
	if (!element) {
		return;
	}

	if (entries.length == 0) {
		element.innerHTML = "No matches";
		return;
	}
	var tsource = document.querySelector("#music-browse-template").textContent;
	var template = Handlebars.compile(tsource);
	element.innerHTML = template(entries);
}



//////////////////////////////
//
// insertCgiSearchParameters -- Take browse parameters from the
//     URL and insert into search fields.
//

function insertCgiSearchParameters() {

	if (CGI.year) {
		var yearelement = document.querySelector("#browse-year");
		if (yearelement) {
			yearelement.value = CGI.year;
		}
	}

	if (CGI.location) {
		var locationelement = document.querySelector("#browse-location");
		if (locationelement) {
			locationelement.value = CGI.location;
		}
	}

	if (CGI.publocation) {
		var publocationelement = document.querySelector("#browse-publocation");
		if (publocationelement) {
			publocationelement.value = CGI.publocation;
		}
	}

	if (CGI.manlocation) {
		var manlocationelement = document.querySelector("#browse-manlocation");
		if (manlocationelement) {
			manlocationelement.value = CGI.manlocation;
		}
	}

	if (CGI.publisher) {
		var publisherelement = document.querySelector("#browse-publisher");
		if (publisherelement) {
			publisherelement.value = CGI.publisher;
		}
	}

	if (CGI.rism) {
		var rismelement = document.querySelector("#browse-rism");
		var rism = cleanRismText(CGI.rism);
		if (rismelement) {
			rismelement.value = rism;
		}
	}

	if (CGI.composer) {
		var composerelement = document.querySelector("#browse-composer");
		var composer = CGI.composer;
		if (composerelement) {
			composerelement.value = composer;
		}
	}

	if (CGI.final) {
		var finalelement = document.querySelector("#browse-final");
		var final = CGI.final;
		if (finalelement) {
			finalelement.value = final;
		}
	}

	if (CGI.mensuration) {
		var mensurationelement = document.querySelector("#browse-mensuration");
		var mensuration = CGI.mensuration;
		if (mensurationelement) {
			mensurationelement.value = mensuration;
		}
	}

	if (CGI.key) {
		var keyelement = document.querySelector("#browse-key");
		var key = CGI.key;
		if (keyelement) {
			keyelement.value = key;
		}
	}

	if (CGI.mdedicatee) {
		var mdedicateeelement = document.querySelector("#browse-mdedicatee");
		var mdedicatee = CGI.mdedicatee;
		if (mdedicateeelement) {
			mdedicateeelement.value = mdedicatee;
		}
	}

	if (CGI.title) {
		var titleelement = document.querySelector("#browse-title");
		var title = CGI.title;
		if (titleelement) {
			titleelement.value = title;
		}
	}


   // Literary-specific searching (automatically sets the type=literary
	// in the DOMContentLoaded listener).

	if (CGI.genre) {
		var genreelement = document.querySelector("#browse-litgenre");
		var genre = CGI.genre;
		if (genreelement) {
			genreelement.value = genre;
		}
	}

	if (CGI.manuscript) {
		var manuscriptelement = document.querySelector("#browse-manuscript");
		var manuscript = CGI.manuscript;
		if (manuscriptelement) {
			manuscriptelement.value = manuscript;
		}
	}

	if (CGI.print) {
		var printelement = document.querySelector("#browse-print");
		var print = CGI.print;
		if (printelement) {
			printelement.value = print;
		}
	}

	if (CGI.dedicatee) {
		var dedicateeelement = document.querySelector("#browse-dedicatee");
		var dedicatee = CGI.dedicatee;
		if (dedicateeelement) {
			dedicateeelement.value = dedicatee;
		}
	}

}



///////////////////////////////
//
// cleanRismText -- Format RISM A/I correctly.
//

function cleanRismText(rism) {
	var matches;
	if (matches = rism.match(/^([A-Z])(\d+)$/)) {
		rism = matches[1] + " " + matches[2];
	} else if (matches = rism.match(/^([A-Z])-(\d+)$/)) {
		rism = matches[1] + " " + matches[2];
	} else if (matches = rism.match(/^([A-Z])_(\d+)$/)) {
		rism = matches[1] + " " + matches[2];
	} else if (matches = rism.match(/^([a-z])(\d+)$/)) {
		rism = matches[1].toUpperCase() + " " + matches[2];
	} else if (matches = rism.match(/^([a-z])-(\d+)$/)) {
		rism = matches[1].toUpperCase() + " " + matches[2];
	} else if (matches = rism.match(/^([a-z])_(\d+)$/)) {
		rism = matches[1].toUpperCase() + " " + matches[2];
	}
	return rism;
}



//////////////////////////////
//
// displayLiteraryBrowseEntries --
//

function displayLiteraryBrowseEntries(entries, genre) {
	var element = document.querySelector("#browse-results");
	if (!element) {
		return;
	}

	if (entries.length == 0) {
		element.innerHTML = "No matches";
		return;
	}
	var tsource = document.querySelector("#literary-browse-template").textContent;
	var template = Handlebars.compile(tsource);
	element.innerHTML = template(entries);
	if (genre == "aminta") {
		var table = document.querySelector("#browse-results table");
		var rows = table.querySelectorAll("tr");
		for (var i=0; i<rows.length; i++) {
			// var tds = rows[i].
// ggg
		}
	}
}




//////////////////////////////
//
// setupMusicBrowseCallbacks --
//

function setupMusicBrowseCallbacks() {

	var composerElement = document.querySelector("#browse-composer");
	if (composerElement) {
		composerElement.addEventListener("input", function() { 
			fillMusicBrowsePage();
		});
	}

	var finalElement = document.querySelector("#browse-final");
	if (finalElement) {
		finalElement.addEventListener("input", function() { 
			fillMusicBrowsePage();
		});
	}

	var mensurationElement = document.querySelector("#browse-mensuration");
	if (mensurationElement) {
		mensurationElement.addEventListener("input", function() { 
			fillMusicBrowsePage();
		});
	}

	var keyElement = document.querySelector("#browse-key");
	if (keyElement) {
		keyElement.addEventListener("input", function() { 
			fillMusicBrowsePage();
		});
	}

	var mdedicateeElement = document.querySelector("#browse-mdedicatee");
	if (mdedicateeElement) {
		mdedicateeElement.addEventListener("input", function() { 
			fillMusicBrowsePage();
		});
	}

	var titleElement = document.querySelector("#browse-title");
	if (titleElement) {
		titleElement.addEventListener("input", function() { 
			fillMusicBrowsePage();
		});
	}

	var locationElement = document.querySelector("#browse-location");
	if (locationElement) {
		locationElement.addEventListener("input", function() { 
			fillMusicBrowsePage();
		});
	}

	var yearElement = document.querySelector("#browse-year");
	if (yearElement) {
		yearElement.addEventListener("input", function() { 
			fillMusicBrowsePage();
		});
	}

	var publisherElement = document.querySelector("#browse-publisher");
	if (publisherElement) {
		publisherElement.addEventListener("input", function() { 
			fillMusicBrowsePage();
		});
	}

	var rismElement = document.querySelector("#browse-rism");
	if (rismElement) {
		rismElement.addEventListener("input", function() { 
			fillMusicBrowsePage();
		});
	}

	var ovoicesElement = document.querySelector("#browse-ovoices");
	if (ovoicesElement) {
		ovoicesElement.addEventListener("input", function() { 
			fillMusicBrowsePage();
		});
	}

	var evoicesElement = document.querySelector("#browse-evoices");
	if (evoicesElement) {
		evoicesElement.addEventListener("input", function() { 
			fillMusicBrowsePage();
		});
	}

	var genreList = document.querySelector("select.genre");
	if (genreList) {
		genreList.addEventListener("change", function () {
			fillMusicBrowsePage();
		});
	}

}



//////////////////////////////
//
// setupLiteraryBrowseCallbacks --
//

function setupLiteraryBrowseCallbacks() {

	var titleElement = document.querySelector("#browse-title");
	if (titleElement) {
		titleElement.addEventListener("input", function() { 
			fillLiteraryBrowsePage();
		});
	}

	var dedicateeElement = document.querySelector("#browse-dedicatee");
	if (dedicateeElement) {
		dedicateeElement.addEventListener("input", function() { 
			fillLiteraryBrowsePage();
		});
	}

	var litgenreElement = document.querySelector("#browse-litgenre");
	if (litgenreElement) {
		litgenreElement.addEventListener("input", function() { 
			fillLiteraryBrowsePage();
		});
	}

	var manuscriptElement = document.querySelector("#browse-manuscript");
	if (manuscriptElement) {
		manuscriptElement.addEventListener("input", function() { 
			fillLiteraryBrowsePage();
		});
	}

	var printElement = document.querySelector("#browse-print");
	if (printElement) {
		printElement.addEventListener("input", function() { 
			fillLiteraryBrowsePage();
		});
	}

	var genreList = document.querySelector("select.genre");
	if (genreList) {
		genreList.addEventListener("change", function () {
			fillLiteraryBrowsePage();
		});
	}

	var publocationElement = document.querySelector("#browse-publocation");
	if (publocationElement) {
		publocationElement.addEventListener("input", function() { 
			fillLiteraryBrowsePage();
		});
	}

	var manlocationElement = document.querySelector("#browse-manlocation");
	if (manlocationElement) {
		manlocationElement.addEventListener("input", function() { 
			fillLiteraryBrowsePage();
		});
	}

}


//////////////////////////////
//
// sortByText --
//

function sortByText(index, selector) {
	var data = document.querySelectorAll(".data");
	var datalist = [];
	var i;
	for (i=0; i<data.length; i++) {
		datalist.push(data[i]);
	}
	datalist.sort(function(a, b) {
		var A;
		var B;
		if (selector) {
			A = a.cells[index].querySelector(selector).innerHTML;
			B = b.cells[index].querySelector(selector).innerHTML;
		} else {
			A = a.cells[index].textContent;
			B = b.cells[index].textContent;
		}
		if (A.match(/^\s*$/)) {
			return +1;
		}
		if (B.match(/^\s*$/)) {
			return -1;
		}
		var result = A.localeCompare(B);
		return result;
	});

	var body = document.querySelector("table.music-browse-list tbody");
	if (body === null) {
		body = document.querySelector("table.literary-browse-list tbody");
	}
	body.innerHTML = "";
	for (i=0; i<datalist.length; i++) {
		body.appendChild(datalist[i]);
	}
}



//////////////////////////////
//
// sortByVoice -- Currently the same as sortByText, but may change in the future.
//

function sortByVoice(index, selector) {
	var data = document.querySelectorAll(".data");
	var datalist = [];
	var i;
	for (i=0; i<data.length; i++) {
		datalist.push(data[i]);
	}
	datalist.sort(function(a, b) {
		var A;
		var B;
		if (selector) {
			A = a.cells[index].querySelector(selector).innerHTML;
			B = b.cells[index].querySelector(selector).innerHTML;
		} else {
			A = a.cells[index].textContent;
			B = b.cells[index].textContent;
		}
		if (A.match(/^\s*$/)) {
			return +1;
		}
		if (B.match(/^\s*$/)) {
			return -1;
		}
		var result = A.localeCompare(B);
		return result;
	});

	var body = document.querySelector("table.music-browse-list tbody");
	if (body === null) {
		body = document.querySelector("table.literary-browse-list tbody");
	}
	body.innerHTML = "";
	for (i=0; i<datalist.length; i++) {
		body.appendChild(datalist[i]);
	}
}



//////////////////////////////
//
// sortByYear --
//

function sortByYear(index, selector) {
	var data = document.querySelectorAll(".data");
	var datalist = [];
	var i;
	for (i=0; i<data.length; i++) {
		datalist.push(data[i]);
	}
	datalist.sort(function(a, b) {
		var A;
		var B;
		if (selector) {
			A = a.cells[index].querySelector(selector).innerHTML;
			B = b.cells[index].querySelector(selector).innerHTML;
		} else {
			A = a.cells[index].textContent;
			B = b.cells[index].textContent;
		}
		var matches;
		if (matches = A.match(/(\d{4})/)) {
			A = matches[1];
		} else {
			A = "";
		}
		if (matches = B.match(/(\d{4})/)) {
			B = matches[1];
		} else {
			B = "";
		}
		if (A.match(/^\s*$/)) {
			return +1;
		}
		if (B.match(/^\s*$/)) {
			return -1;
		}
		var result = A.localeCompare(B);
		return result;
	});

	var body = document.querySelector("table.music-browse-list tbody");
	if (body === null) {
		body = document.querySelector("table.literary-browse-list tbody");
	}
	body.innerHTML = "";
	for (i=0; i<datalist.length; i++) {
		body.appendChild(datalist[i]);
	}
}



//////////////////////////////
//
// displaySingleWork --
//

function displaySingleWork(id) {
	if (!id) {
		return;
	}
	window.location.href = "/work?id=" + id;
}



//////////////////////////////
//
// prepareRsources --
//

function prepareRsources() {
	var prints = TASSODATA.PRINTS.PRINT;
	var manuscripts = TASSODATA.MANUSCRIPTS.MANUSCRIPT;
	var i;
	for (i=0; i<prints.length; i++) {
		RSOURCES[prints[i].SPRINTNUM] = prints[i];
	}
	for (i=0; i<manuscripts.length; i++) {
		RSOURCES[manuscripts[i].SMSIGLUM] = manuscripts[i];
	}
}


</script>

