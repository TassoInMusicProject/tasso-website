<script>
// vim: ts=3 ft=javascript


//////////////////////////////
//
// DOMContentLoaded event listener --
//

let Editor = false;

document.addEventListener("DOMContentLoaded", function() {
	CGI = GetCgiParameters();
	console.log("CGI", CGI);
	if (CGI.edit) {
		Editor = true;
		console.log("EDITOR TRUE");
	}
	if (CGI.rime) {
		var id = "Trm";
		if (CGI.rime < 1000) { id += "0"; }
		if (CGI.rime < 100)  { id += "0"; }
		if (CGI.rime < 10)   { id += "0"; }
		id += CGI.rime;
		CurrentPoem = id;
	   // displayMarkup(id, "#contents");
	} else if (CGI.id) {
			CurrentPoem = CGI.id;
	} else {
		CurrentPoem = "Trm0048";
	}
	LoadTassoData(displayMarkupInitialize);
});


//////////////////////////////
//
// Show editor if &edit=true is present in the URL.
//

document.addEventListener("DOMContentLoaded", function() {
	if (!Editor) {
		return;
	}
	let element = document.querySelector("textarea");
	if (!element) {
		return;
	}
	element.style.visibility = "visible";
});


//////////////////////////////
//
// process Window keys down:
//

window.addEventListener('keydown', function(event) {
   if (event.metaKey) {
		return;
	}

	switch (event.keyCode) {
		case LeftArrowKey:
			if (event.shiftKey) {
				displaySource();
			} else {
				displayPreviousPoem();
			}
			break;
		case RightArrowKey:
			if (event.shiftKey) {
				displaySetting();
			} else {
				displayNextPoem();
			}
			break;
		case UpArrowKey:
   		window.location = "/variants";
			break;
	}

});


</script>
