
<!-- Handlebars templates for browse page.
	vim: ts=3 ft=javascript
	-->

<!-- music-browse-template -->

{% raw %}
<style>
	table.music-browse-list { border-collapse: collapse; width: 100%; margin-left: -40px; margin-right:-20px; padding-right:-20px; }
	table.music-browse-list td { padding-bottom: 7px; padding-right:20px; }
	table.music-browse-list th { padding-bottom: 12px; }
	table.music-browse-list tr:hover { background: #f5f5f5; }
	table.music-browse-list tr td.voices { padding-left: 5px }
</style>
<script id="music-browse-template" type="text/x-handlebars-template">
	<table class="music-browse-list" style="border-collapse:collapse;">
	<thead style="color: #B19C5F;">
		<th onclick="sortByText(0)"  style="cursor:pointer; text-align:left">Catalog</th>
		<th onclick="sortByText(1)"  style="cursor:pointer; text-align:left">Composer</th>
		<th onclick="sortByText(2)"  style="cursor:pointer; text-align:left">Title</th>
		<th onclick="sortByYear(3)"  style="cursor:pointer; text-align:center">Year</th>
		<th onclick="sortByVoice(4)" style="cursor:pointer; text-align:center">Voices</th>
		<th onclick="sortByText(5)"  style="cursor:pointer; text-align:center">Mens.</th>
		<th onclick="sortByText(6)"  style="cursor:pointer; text-align:center">Clefs</th>
		<th onclick="sortByText(7)"  style="cursor:pointer; text-align:center">Key&nbsp;&nbsp;&nbsp;</th>
		<th onclick="sortByText(8)"  style="cursor:pointer; text-align:center">Final</th>
	<thead>
	<tbody>
	{{#each this}}
{{{printobject this}}}
		<tr class="data" style="vertical-align:baseline">
			<td class="id" id="{{CATALOGNUM}}" onclick="displaySingleWork('{{CATALOGNUM}}');" style="cursor:pointer; padding-right:20px;">{{CATALOGNUM}}</td>
			<td onclick="displaySingleWork('{{CATALOGNUM}}');" style="cursor:pointer; padding-right:20px;"><nobr>{{shortName COMPOSER}}</nobr></td>
			<td onclick="displaySingleWork('{{CATALOGNUM}}');" style="cursor:pointer; max-width:450px; padding-right:20px;"> {{{title this}}} {{{parentheticalinfo this}}}</td>
			<td onclick="displaySingleWork('{{CATALOGNUM}}');" align="center" style="padding-right:20px'">{{{publication this}}}</td>
			<td class="voices" onclick="displaySingleWork('{{CATALOGNUM}}');" align="center" style="padding-right:20px'">{{{voices OVOICES EXTANTVOICES}}}</td>
			<td onclick="displaySingleWork('{{CATALOGNUM}}');" align="center" style="padding-right:20px'">{{{mensuration this}}}</td>
			<td onclick="displaySingleWork('{{CATALOGNUM}}');" align="center" style="padding-right:20px'">{{{clefs this}}}</td>
			<td onclick="displaySingleWork('{{CATALOGNUM}}');" align="center" style="padding-right:20px'">{{{keysig this}}}</td>
			<td onclick="displaySingleWork('{{CATALOGNUM}}');" align="center" style="padding-right:20px'">{{{finalis this}}}</td>
		</tr>
	{{/each}}
	</tbody>
	</table>
</script>
{% endraw %}





<!-- literary-browse-template -->

{% raw %}
<style>
	table.literary-browse-list { width: 100%; margin-left: -40px; }
	table.literary-browse-list td { padding-bottom: 7px; }
	table.literary-browse-list th { padding-bottom: 12px; }
	table.literary-browse-list tr:hover { background: #f5f5f5; }
	table.literary-browse-list tr td:nth-child(3) { padding-right: 5px; }

	table.literary-browse-list .genre-aminta { display: none; }
	table.literary-browse-list .genre-gerusalemme { display: none; }
	table.literary-browse-list .genre-rinaldo { display: none; }
	table.literary-browse-list .genre-ecloghe { display: none; }
	table.literary-browse-list .genre-torrismondo { display: none; }
	table.literary-browse-list .genre-lagrime { display: none; }
	table.literary-browse-list .genre-conquistata { display: none; }

	table.literary-browse-list .dedicatee-aminta { display: none; }
	table.literary-browse-list .dedicatee-gerusalemme { display: none; }
	table.literary-browse-list .dedicatee-rinaldo { display: none; }
	table.literary-browse-list .dedicatee-ecloghe { display: none; }
	table.literary-browse-list .dedicatee-torrismondo { display: none; }
	table.literary-browse-list .dedicatee-lagrime { display: none; }
	table.literary-browse-list .dedicatee-conquistata { display: none; }

	table.literary-browse-list .title-aminta { min-width: 250px; }
	table.literary-browse-list .title-gerusalemme { min-width: 250px; }
	table.literary-browse-list .title-rinaldo { min-width: 250px; }
	table.literary-browse-list .title-ecloghe { min-width: 250px; }
	table.literary-browse-list .title-torrismondo { min-width: 250px; }
	table.literary-browse-list .title-lagrime { min-width: 250px; }
	table.literary-browse-list .title-conquistata { min-width: 250px; }

</style>

<script id="literary-browse-template" type="text/x-handlebars-template">
	<table style="border-collapse: collapse;" class="literary-browse-list">
	<thead style="color: #B19C5F;">
		<th onclick="sortByText(0)" class="catalog{{{displayclass this}}}" style="margin-right:10px; cursor:pointer; text-align:left">Catalog</th>
		<th onclick="sortByText(1)" class="litgenre{{{displayclass this}}}" style="margin-right:10px; cursor:pointer; text-align:left;">Genre&nbsp;&nbsp;&nbsp;</th>
		<th onclick="sortByText(2)" class="title{{{displayclass this}}}" style="padding-right:15px; cursor:pointer; text-align:left;">Title</th>
		<th onclick="sortByText(3)" class="dedicatee{{{displayclass this}}}" style="cursor:pointer; text-align:left;">Dedicatee</th>
		<th onclick="sortByText(4)" class="sources{{{displayclass this}}}" style="cursor:pointer; text-align:left;">Sources</th>
	<thead>
	<tbody>
	{{#each this}}
		<tr class="data" style="vertical-align:baseline">
			<td style="padding-right:15px !important;" class="catalog{{{displayclass this}}}"><a href="/settings?id={{CATALOGNUM}}">{{CATALOGNUM}}</a></td>
			<td style="padding-right:10px !important;" class="genre{{{displayclass this}}}">{{{shortGenre GENRE}}}</td>
			<td class="title{{{displayclass this}}}">{{{TITLE}}} {{{parentheticalinfo this}}}</td>
			<td class="dedicatee{{{displayclass this}}}" style="padding-right:10px">{{{shortName DEDICATEE}}}</td>
			<td class="sources{{{displayclass this}}}">{{{manuscriptSrc MANUSRC}}}<br>{{{printSrc PRINTSRC}}}</td>
		</tr>
	{{/each}}
	</tbody>
	</table>
</script>
{% endraw %}



<script>


//////////////////////////////
//
// printobject Handlebar helper --
//

Handlebars.registerHelper("printobject", function (object) {
	// console.log("OBJECT", object);
	// console.log("mensuration", object.OMENSURATION);
	return new Handlebars.SafeString("");
});



//////////////////////////////
//
// title Handlebar helper --
// 
// title {{{RIMETITLE}}} (<i>rime</i>&nbsp;{{SOLERTI}})
//

Handlebars.registerHelper("title", function (object) {
	var output = "";
	if (object.RIMETITLE) {
		output += object.RIMETITLE;
		// output += " (<i>rime</i>&nbsp;";
		// output += object.SOLERTI;
		// output += ")";
	} else if (object.TITLE) {
		output += object.TITLE;
	} else {
		// console.log("OBJECT", object);
		// output += "UNKNOWN";
	}
	return new Handlebars.SafeString(output);
});



//////////////////////////////
//
// clefs Handlebar helper --
//			<td onclick="displaySingleWork('{{CATALOGNUM}}');" style="padding-right:20px'">{{{clefs this}}}</td>
//

Handlebars.registerHelper("clefs", function(object) {
	var clefs = object.OCLEFS;
	if (!clefs) {
		clefs = "";
	}
	clefs = clefs.replace(/[, ]+/g, ", ");
	clefs = clefs.replace(/,\s*$/, "").replace(/^\s*,\s*/, "");
	var output = "<div style='line-height:1.05rem; margin-top:7px; font-size:1.15rem;'>";
	output +=  clefs;
	output += "</div>";
	return new Handlebars.SafeString(output);
});



//////////////////////////////
//
// clefs Handlebar helper --
//			<td onclick="displaySingleWork('{{CATALOGNUM}}');" style="padding-right:20px'">{{{clefs this}}}</td>
//

Handlebars.registerHelper("keysig", function(object) {
	var keysig = object.OKEYSIG;
	if (!keysig) {
		keysig = "";
	}
	if (keysig.match(/b-flat/i)) {
			keysig = "&flat;";
	}
	if (keysig.match(/b-/i)) {
			keysig = "&flat;";
	}
	var output = keysig;
	return new Handlebars.SafeString(output);
});




//////////////////////////////
//
// finalis Handlebar helper -- display the final of the music.
//

Handlebars.registerHelper("finalis", function(object) {
	if (!object) {
		return new Handlebars.SafeString("ERROR");
	}
	if (!object.FINAL) {
		// no FINAL information stored in entry (yet).
		return new Handlebars.SafeString("");
	}
	// Force pitch name to upper case if it is not already:
	return new Handlebars.SafeString(object.FINAL.toUpperCase());
});



//////////////////////////////
//
// mensuration Handlebar helper --
//

Handlebars.registerHelper("mensuration", function(object) {
	var mensuration = object.OMENSURATION;
	mensuration = mensuration.replace(/,.*/, "");
	var output = "";
	if (mensuration) {
		if (mensuration === "C") {
			output = "c";
		} else if (mensuration === "Cut-C") {
			output = "c<span style='position:relative; top:1px; margin-left:-6px'>|</span>";
		} else if (mensuration === "C|") {
			output = "c<span style='position:relative; top:1px; margin-left:-6px'>|</span>";
		} else if (mensuration === "C-dot 3/2") {
			output = "C<span style='position:relative; top:-6px; margin-left:-8px'>.</span>";
			output += "<span style='position:relative; font-size:0.9rem; top:-8px; margin-left:4px'>3</span>";
			output += "<span style='position:relative; font-size:0.9rem; top:3px; margin-left:-7px'>2</span>";
		} else if (mensuration === "O 3/2") {
			output = "O";
			output += "<span style='position:relative; font-size:0.9rem; top:-8px; margin-left:0px'>3</span>";
			output += "<span style='position:relative; font-size:0.9rem; top:3px; margin-left:-7px'>2</span>";
		} else if (mensuration === "Cut-Circle3") {
			output = "o<span style='position:relative; top:1px; margin-left:-8px'>|</span>";
			output += "<span style='position:relative; font-size:1rem; top:1px; margin-left:3px'>3</span>";
		} else {
			output = mensuration;
		}
	} else {
		output = "";
	}
	return new Handlebars.SafeString(output);
});



//////////////////////////////
//
// publication Handlebar helper --
// 
// title {{{RIMETITLE}}} (<i>rime</i>&nbsp;{{SOLERTI}})
// <span title="{{{PRINCEPSTITLE}}}">{{pubInfo NORMLOC NORMPUBSHORT}}, {{PRINCEPSYEAR}}</span>
//

Handlebars.registerHelper("publication", function(object) {
	var loc  = object.NORMLOC;
	var pub  = object.NORMPUBSHORT;
	var pti  = object.PRINCEPSTITLE;
	var year = object.PRINCEPSYEAR;

	var title = "";
	if (pti) {
		title += pti;
		title += " (";
		title += loc + ": " + pub;
		title += ")";
	}

	var output = "<span";
	output += " title=\"";
	output += title;
	output += "\">";
	output += year;
	output += "</span>";

	return new Handlebars.SafeString(output);
});




//////////////////////////////
//
// manuscriptSrc Handlebar helper --
//

Handlebars.registerHelper("manuscriptSrc", function(src) {
	var list = [];
	if (src.match(/letter/)) {
		// Manuscript letter to Giulio Segni (23 June, 1587)
		// letter to G. Segni (23 June 1587)
		list[0] = src.replace(/^Manuscript /, "").replace(/Giulio/, "G.");
	} else {
		list = src.split(/,\s+/);
	}
	var output = "";
	var matches;
	for (var i=0; i<list.length; i++) {
		var minfo = RSOURCES[list[i]];
		var info = "";
		if (!minfo) {
			if (!list[i].match(/none/i)) {
				// console.log("Error:", list[i], "is not found in manuscript database");
			}
		} else {
			if (minfo.SIGLUM) {
				info += minfo.SIGLUM;
			}
			if (minfo.LOCATION) {
				if (info) {
					info += ", ";
				}
				if (matches = minfo.LOCATION.match(/([^,]+), ([^,]+), (.*)/)) {
					// no country information
					info += matches[1] + ", " + matches[2];
				} else {
					// Vatican city case
					info += minfo.LOCATION;
				}
			}
			if (minfo.DATING) {
				if (info) {
					info += ", ";
				}
				info += minfo.DATING;
			}
		}
		if (list[i].match(/none/i)) {
			info = "no manuscript sources for poem";
		} else if (info.match(/^\s*$/)) {
			info = "missing information for manuscript " + list[i];
		} else {
			info = list[i] + ": " + info;
		}
		output += "<span class='tooltip'>";
		var submatch = 0;

		var source;
		if (SOURCEHILIGHT.LOCATION && SOURCEHILIGHT.MANUSCRIPT) {
			source = RMANUSCRIPTS[list[i]];
			if (source.LOCATION) {
				if (source.LOCATION.match(SOURCEHILIGHT.LOCATION)) {
					if (source.SMSIGLUM === SOURCEHILIGHT.MANUSCRIPT) {
						submatch = 1;
					}
				}
			}
		} else if (SOURCEHILIGHT.LOCATION && !SOURCEHILIGHT.MANUSCRIPT) {
			source = RMANUSCRIPTS[list[i]];
			if (source && source.LOCATION) {
				if (source.LOCATION.match(SOURCEHILIGHT.LOCATION)) {
					submatch = 1;
				}
			}
		} else if (!SOURCEHILIGHT.LOCATION && SOURCEHILIGHT.MANUSCRIPT) {
			source = RMANUSCRIPTS[list[i]];
			if (source && source.SMSIGLUM) {
				if (source.SMSIGLUM.match(SOURCEHILIGHT.MANUSCRIPT)) {
					submatch = 1;
				}
			}
		}

		if (submatch) {
			output += "<span style='font-weight:bold; color:#900;'>" + list[i] + "</span>";
		} else {
			output += list[i];
		}
		output += "<span class='tooltiptext'>" + info + "</span>";
		output += "</span>";
		if (i < list.length - 1) {
			output += ", ";
		}
	}
	return new Handlebars.SafeString(output);
});



//////////////////////////////
//
// printSrc Handlebar helper --
//

Handlebars.registerHelper("printSrc", function(src) {
	var list = src.split(/,\s+/);
	var output = "";
	for (var i=0; i<list.length; i++) {
		var pinfo = RSOURCES[list[i]];
		var info = "";
		if (!pinfo) {
			if (!list[i].match(/none/i)) {
				// console.log("Error:", list[i], "is not found in print database");
			}
		} else {
			if (pinfo.PRINTTITLE) {
				info += "<i>" + pinfo.PRINTTITLE + "</i>";
			}
			var pub = "";
			if (pinfo.PUBLISHER) {
				pub = pinfo.PUBLISHER;
			}
			if (pinfo.PUBLOCATION) {
				if (pub.match(/^\s*$/)) {
					pub = pinfo.PUBLOCATION;
				} else {
					pub = pinfo.PUBLOCATION + ": " + pub;
				}
			}
			if (pinfo.PUBYEAR) {
				if (pub.match(/^\s*$/)) {
					pub = pinfo.PUBYEAR;
				} else {
					pub += ", " + pinfo.PUBYEAR;
				}
			}
			if (!pub.match(/^\s*$/)) {
				info += " (" + pub + ")";
			}
		}
		if (list[i].match(/none/i)) {
			info = "no print sources for poem";
		} else if (info.match(/^\s*$/)) {
			info = "missing information for print" + list[i];
		} else {
			info = list[i] + ": " + info;
		}
		output += "<span class='tooltip'>";
		var submatch = 0;
		var source;

		if (SOURCEHILIGHT.PUBLOCATION && SOURCEHILIGHT.PRINT) {
			source = RPRINTS[list[i]];
console.log("RPRINT SOURCE", source, "LISTI", list[i]);
			if (source && source.PUBLOCATION) {
				if (source.PUBLOCATION.match(SOURCEHILIGHT.PUBLOCATION)) {
					if (source.SPRINTNUM === SOURCEHILIGHT.PRINT) {
						submatch = 1;
					}
				}
			}
		} else if (SOURCEHILIGHT.PUBLOCATION && !SOURCEHILIGHT.PRINT) {
			source = RPRINTS[list[i]];
			if (source && source.PUBLOCATION) {
				if (source.PUBLOCATION.match(SOURCEHILIGHT.PUBLOCATION)) {
					submatch = 1;
				}
			}

		} else if (!SOURCEHILIGHT.PUBLOCATION && SOURCEHILIGHT.PRINT) {
			source = RPRINTS[list[i]];
			if (source && source.SPRINTNUM) {
				if (source.SPRINTNUM.match(SOURCEHILIGHT.PRINT)) {
					submatch = 1;
				}
			}

		} else if (SOURCEHILIGHT.LITPUB && SOURCEHILIGHT.PRINT) {
			source = RPRINTS[list[i]];
			if (source && source.LITPUB) {
				if (source.LITPUB.match(SOURCEHILIGHT.PUBLISHER)) {
					submatch = 1;
				}
			}

		} else if (SOURCEHILIGHT.LITPUB && !SOURCEHILIGHT.PRINT) {
			source = RPRINTS[list[i]];
			if (source && source.PUBLISHER) {
				if (source.PUBLISHER.match(SOURCEHILIGHT.LITPUB)) {
					submatch = 1;
				}
			}
		}


		if (submatch) {
			output += "<span style='font-weight:bold; color:#900;'>" + list[i] + "</span>";
		} else {
			output += list[i];
		}

		output += "<span class='tooltiptext'>" + info + "</span>";
		output += "</span>";
		if (i < list.length - 1) {
			output += ", ";
		}
	}
	return new Handlebars.SafeString(output);
});



//////////////////////////////
//
// shortName Handlebar helper  -- Prevent linebreak after RISM
//      and its number.
// 
// @COMPOSER:	Bottegari, Cosimo (?) => Bottegari, C.(?)
//

Handlebars.registerHelper("shortName", function(text) {
	if (!text) {
		return new Handlebars.SafeString("");
	}
	var output;
	var matches;
	var originaltext = text;

	text = text.replace(/^\s+/, "").replace(/\s+$/, "");
	var lastname = text;
	var firstname = text;
	var question = "";
	if (text.match(/\(\?\)/)) {
		question = "(?)";
		text = text.replace(/\(\?\)/, "");
	}
	text = text.replace(/\s+$/, "").replace(/^\s+/, "");
	var abbrname = "";
	var pieces;
	if (!text.match(/(.*),\s+(.*)/)) {
		text = text.replace(/\.\s*/, ", ");
	}
	if (matches = text.match(/(.*),\s+(.*)/)) {
		lastname = matches[1];
		firstname = matches[2];
		pieces = firstname.split(/\s+/);
		abbrname = "";
		for (var i=0; i<pieces.length; i++) {
			if (pieces[i][0] == pieces[i][0].toLowerCase()) {
				// such as "del"
				abbrname += " " + pieces[i];
			} else if (pieces[i][0] == pieces[i][0].toUpperCase()) {
				abbrname += " " + pieces[i][0] + ".";
			} else {
				// strange case
				abbrname += " " + pieces[i];
			}
		}
		var shortname;
		if (abbrname.length > 0) {
			shortname = lastname + "," + abbrname + question;
		} else {
			shortname = lastname;
		}
		if (shortname.length > 15) {
			output = "<span style='letter-spacing:-1px; word-spacing:-1px;' ";
			output+= "title='" + originaltext +"'>";
			output += shortname + "</a>";
		} else {
			output = "<span title='";
			output += originaltext + "'>";
			output += shortname + "</a>";
		}

		if (output.match(/Este.*Medici/)) {
			output = "d'Este &amp; de'Medici";
		}
		if (output.match(/Este.*Gonzaga/)) {
			output = "d'Este &amp; Gonzaga";
		}
		if (output.match(/Vincenzo.*Farnese/)) {
			output = "Vincenzo &amp; Farnese";
		}
		return new Handlebars.SafeString(output.replace(/\s+/g, "&nbsp;"));
	} else {

		if (text.match(/Este.*Medici/)) {
			text = "d'Este &amp; de'Medici";
		}
		if (text.match(/Este.*Gonzaga/)) {
			text = "d'Este &amp; Gonzaga";
		}
		if (text.match(/Vincenzo.*Farnese/)) {
			text = "Vincenzo &amp; Farnese";
		}
		return new Handlebars.SafeString(text.replace(/\s+/g, "&nbsp;"));
	}
});



//////////////////////////////
//
// shortGenre Handlebar helper  -- add linebreak for slashes
//

Handlebars.registerHelper("shortGenre", function(text) {
	if (!text) {
		return new Handlebars.SafeString("");
	}
	text = text.replace("/", "&nbsp;/ ", "g");
	return new Handlebars.SafeString(text);
});



//////////////////////////////
//
// displayclass Handlebar helper  -- display original and extant voices.
//

Handlebars.registerHelper("displayclass", function(obj) {
	var output = "";
	if (!obj) {
		output = "";
		return new Handlebars.SafeString(output);
	}
	var catalog = "";
	if (Array.isArray(obj)) {
		if (obj.length == 0) {
			output = "";
			return new Handlebars.SafeString(output);
		}
		catalog = obj[0].CATALOGNUM;
	} else {
		catalog = obj.CATALOGNUM;
	}
	if (!catalog) {
		output = "";
		return new Handlebars.SafeString(output);
	}
	if (catalog.match(/^Tam/)) {
		output = "-aminta";
	} else if (catalog.match(/^Tsg/)) {
		output = "-gerusalemme";
	} else if (catalog.match(/^Tri/)) {
		output = "-rinaldo";
	} else if (catalog.match(/^Trt/)) {
		output = "-torrismondo";
	} else if (catalog.match(/^Tec/)) {
		output = "-ecloghe";
	} else if (catalog.match(/^Tbv/)) {
		output = "-lagrime";
	} else if (catalog.match(/^Tco/)) {
		output = "-conquistata";
	}

	return new Handlebars.SafeString(output);
});



//////////////////////////////
//
// voices Handlebar helper  -- display original and extant voices.
//

Handlebars.registerHelper("voices", function(ovoice, evoice) {
	if ((!ovoice) && (!evoice)) {
		return new Handlebars.SafeString("");
	}
	if (!ovoice) {
		ovoice = "";
	}
	if (ovoice.match(/alfabeto/)) {
		ovoice = ovoice.replace(/\+?alfabeto/, "");
	}
	ovoice = ovoice.replace(/\s*\+\s*/g, "+");
	if (!evoice) {
		return new Handlebars.SafeString(ovoice);
	}
	if (!evoice) {
		evoice = "";
	}
	evoice = evoice.replace(/\s*\+\s*/g, "+");
	if (evoice.match(/alfabeto/)) {
		evoice = evoice.replace(/\s*\+?\s*alfabeto/, "");
	}
	if (evoice === ovoice) {
		return new Handlebars.SafeString(ovoice);
	}
	evoice = evoice.replace(/b\.?c\.?/gi, "bc");
	ovoice = ovoice.replace(/b\.?c\.?/gi, "bc");
	if (ovoice.match(/b\.?c\.?/i) && evoice.match(/b\.?c\.?/i)) {
		// keep the "bc" information in the extant voices
		// evoice = evoice.replace(/\s*\+?\s*b\.?c\.?/i, "");
	}
	var text = ovoice + "(" + evoice + ")";
	return new Handlebars.SafeString(text);
});

///////////////////////////////
//
// parentheticalinfo --
//

Handlebars.registerHelper("parentheticalinfo",  function (obj) {
	var output = "";
	if (obj.SOLERTI) {
		output = "(<i>Rime</i>&nbsp;" + obj.SOLERTI + ")";
		return new Handlebars.SafeString(output);
	}
	if (obj.CATALOGNUM.match(/^Tam/) && obj.ACT && obj.SCENE && obj.VERSE) {
		output = "(<i>Aminta</i>&nbsp;" + obj.ACT + "/" + obj.SCENE + "/" + obj.VERSE + ")";
		return new Handlebars.SafeString(output);
	}
	if (obj.CATALOGNUM.match(/^Tsg/) && obj.CANTO && obj.OTTAVA) {
		output = "(<i>Gerusalemme</i>&nbsp;" + obj.CANTO + "/" + obj.OTTAVA + ")";
		return new Handlebars.SafeString(output);
	}
	if (obj.CATALOGNUM.match(/^Tec/) && obj.ECLOGA && obj.VERSE) {
		output = "(<i>Ecloga</i>&nbsp;" + obj.ECLOGA + "/" + obj.VERSE + ")";
		return new Handlebars.SafeString(output);
	}
	if (obj.CATALOGNUM.match(/^Tri/) && obj.CANTO && obj.OTTAVA) {
		output = "(<i>Rinaldo</i>&nbsp;" + obj.CANTO + "/" + obj.OTTAVA + ")";
		return new Handlebars.SafeString(output);
	}
	if (obj.CATALOGNUM.match(/^Trt/) && obj.ACT && obj.SCENE && obj.SECTION) {
		output = "(<i>Torrismondo</i>&nbsp;" + obj.ACT + "/" + obj.SCENE + "/" + obj.SECTION + ")";
		return new Handlebars.SafeString(output);
	}
	if (obj.CATALOGNUM.match(/^Tco/) && obj.CANTO && obj.OTTAVA) {
		output = "(<i>G.&nbsp;conquistata</i>&nbsp;" + obj.CANTO + "/" + obj.OTTAVA + ")";
		return new Handlebars.SafeString(output);
	}
	if (obj.CATALOGNUM.match(/^Tbv/) && obj.STANZA) {
		output = "(<i>Lagrime</i>&nbsp;" + obj.STANZA + ")";
		return new Handlebars.SafeString(output);
	}

	return new Handlebars.SafeString(output);
});

</script>




