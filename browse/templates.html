
<!-- Handlebars templates for browse page.
	vim: ts=3 ft=javascript
	-->

<!-- music-browse-template -->

{% raw %}
<style>
	table.music-browse-list td { padding-bottom: 7px; }
	table.music-browse-list th { padding-bottom: 12px; }
	table.music-browse-list tr:hover { background: #f5f5f5; }
	table.music-browse-list tr td.voices { padding-left: 5px }
</style>

<script id="music-browse-template" type="text/x-handlebars-template">
	<table class="music-browse-list">
	<thead style="color: #B19C5F;">
		<th onclick="sortByText(0)" style="width:130px; cursor:pointer; text-align:left">Catalog</th>
		<th onclick="sortByText(1)" style="width:170px; cursor:pointer; text-align:left">Composer</th>
		<th onclick="sortByText(2)" style="cursor:pointer; text-align:left">Title</th>
		<th onclick="sortByYear(3)" style="cursor:pointer; text-align:left">Publication&nbsp;information&nbsp;</th>
		<th onclick="sortByVoice(4)" style="cursor:pointer; text-align:left">Voices</th>
	<thead>
	<tbody>
	{{#each this}}
		<tr class="data" style="vertical-align:top">
			<td class="id" id="{{CATALOGNUM}}" onclick="displaySingleWork('{{CATALOGNUM}}');" style="cursor:pointer; padding-right:20px;">{{CATALOGNUM}}</td>
			<td onclick="displaySingleWork('{{CATALOGNUM}}');" style="cursor:pointer; padding-right:20px;"><nobr>{{shortName COMPOSER}}</nobr></td>
			<td onclick="displaySingleWork('{{CATALOGNUM}}');" style="cursor:pointer; padding-right:20px;">{{{RIMETITLE}}} (<i>rime</i>&nbsp;{{SOLERTI}})</td>
			<td onclick="displaySingleWork('{{CATALOGNUM}}');" style="padding-right:20px'"><span title="{{{PRINCEPSTITLE}}}">{{pubInfo NORMLOC NORMPUBSHORT}}, {{PRINCEPSYEAR}}</span></td>
			<td class="voices" onclick="displaySingleWork('{{CATALOGNUM}}');" style="padding-right:20px'">{{{voices OVOICES EXTANTVOICES}}}</td>
		</tr>
	{{/each}}

	</tbody>
	</table>
</script>
{% endraw %}




<!-- literary-browse-template -->

{% raw %}
<style>
	table.literary-browse-list td { padding-bottom: 7px; }
	table.literary-browse-list th { padding-bottom: 12px; }
	table.literary-browse-list tr:hover { background: #f5f5f5; }
	table.literary-browse-list tr td:nth-child(3) { padding-right: 5px; }
</style>

<script id="literary-browse-template" type="text/x-handlebars-template">
	<table class="literary-browse-list">
	<thead style="color: #B19C5F;">
		<th onclick="sortByText(0)" style="width:130px; cursor:pointer; text-align:left">Catalog</th>
		<th onclick="sortByText(1)" style="cursor:pointer; text-align:left;">Literary&nbsp;genre&nbsp;&nbsp;&nbsp;</th>
		<th onclick="sortByText(2)" style="cursor:pointer; text-align:left;">Title</th>
		<th onclick="sortByText(3)" style="cursor:pointer; text-align:left;">Dedicatee</th>
		<th onclick="sortByText(4)" style="cursor:pointer; text-align:left;">Sources</th>
	<thead>
	<tbody>
	{{#each this}}
		<tr class="data" style="vertical-align:top">
			<td><span style="font-size:85%"><a href="/work?id={{CATALOGNUM}}">{{CATALOGNUM}}</a></span></td>
			<td>{{{shortGenre GENRE}}}</td>
			<td>{{{TITLE}}} (<i>rime</i>&nbsp;{{SOLERTI}})</td>
			<td style="padding-right:10px">{{{shortName DEDICATEE}}}</td>
			<td>{{{manuscriptSrc MANUSRC}}}<br>{{{printSrc PRINTSRC}}}</td>
		</tr>
	{{/each}}
	</tbody>
	</table>
</script>
{% endraw %}



<script>


//////////////////////////////
//
// manuscriptSrc Handlebar helper --
//

Handlebars.registerHelper("manuscriptSrc", function(src) {
	var list = src.split(/,\s+/);
	var output = "";
	for (var i=0; i<list.length; i++) {
		output += "<span class='tooltip'>" + list[i];
		output += "   <span class='tooltiptext'>print info for " + list[i] + " goes here</span>";
		output += "</span>";
		if (i < list.length - 1) {
			output += ", ";
		}
	}
	return new Handlebars.SafeString(output);
});



//////////////////////////////
//
// printSrc Handlebar helper --
//

Handlebars.registerHelper("printSrc", function(src) {
	var list = src.split(/,\s+/);
	var output = "";
	for (var i=0; i<list.length; i++) {
		output += "<span class='tooltip'>" + list[i];
		output += "   <span class='tooltiptext'>print info for " + list[i] + " goes here</span>";
		output += "</span>";
		if (i < list.length - 1) {
			output += ", ";
		}
	}
	return new Handlebars.SafeString(output);
});


//////////////////////////////
//
// pubInfo Handlebar helper  -- 
// 
//

Handlebars.registerHelper("pubInfo", function(loc, pub) {
	if (!(loc || pub)) {
		return new Handlebars.SafeString("");
	}
	if (!loc) {
		return new Handlebars.SafeString(pub);
	}
	if (!pub) {
		return new Handlebars.SafeString(loc);
	}
	return new Handlebars.SafeString(loc + ": " + pub);
});



//////////////////////////////
//
// shortName Handlebar helper  -- Prevent linebreak after RISM
//      and its number.
// 
// @COMPOSER:	Bottegari, Cosimo (?) => Bottegari, C.(?)
//

Handlebars.registerHelper("shortName", function(text) {
	if (!text) {
		return new Handlebars.SafeString("");
	}
	var output;
	var matches;
	var originaltext = text;

	text = text.replace(/^\s+/, "").replace(/\s+$/, "");
	var lastname = text;
	var firstname = text;
	var question = "";
	if (text.match(/\(\?\)/)) {
		question = "(?)";
		text = text.replace(/\(\?\)/, "");
	}
	text = text.replace(/\s+$/, "").replace(/^\s+/, "");
	var abbrname = "";
	var pieces;
	if (!text.match(/(.*),\s+(.*)/)) {
		text = text.replace(/\.\s*/, ", ");
	}
	if (matches = text.match(/(.*),\s+(.*)/)) {
		lastname = matches[1];
		firstname = matches[2];
		pieces = firstname.split(/\s+/);
		abbrname = "";
		for (var i=0; i<pieces.length; i++) {
			if (pieces[i][0] == pieces[i][0].toLowerCase()) {
				// such as "del"
				abbrname += " " + pieces[i];
			} else if (pieces[i][0] == pieces[i][0].toUpperCase()) {
				abbrname += " " + pieces[i][0] + ".";
			} else {
				// strange case
				abbrname += " " + pieces[i];
			}
		}
		var shortname;
		if (abbrname.length > 0) {
			shortname = lastname + "," + abbrname + question;
		} else {
			shortname = lastname;
		}
		if (shortname.length > 15) {
			output = "<span style='letter-spacing:-1px; word-spacing:-1px;' ";
			output+= "title='" + originaltext +"'>";
			output += shortname + "</a>";
		} else {
			output = "<span title='";
			output += originaltext + "'>";
			output += shortname + "</a>";
		}
		return new Handlebars.SafeString(output);
	} else {
		return new Handlebars.SafeString(text);
	}
});



//////////////////////////////
//
// shortGenre Handlebar helper  -- add linebreak for slashes
//

Handlebars.registerHelper("shortGenre", function(text) {
	if (!text) {
		return new Handlebars.SafeString("");
	}
	text = text.replace("/", "&nbsp;/ ", "g");
	return new Handlebars.SafeString(text);
});



//////////////////////////////
//
// voices Handlebar helper  -- display original and extant voices.
//

Handlebars.registerHelper("voices", function(ovoice, evoice) {
	if ((!ovoice) && (!evoice)) {
		return new Handlebars.SafeString("");
	}
	if (!ovoice) {
		ovoice = "";
	}
	if (ovoice.match(/alfabeto/)) {
		ovoice = ovoice.replace(/\+?alfabeto/, "");
	}
	ovoice = ovoice.replace(/\s*\+\s*/g, "+");
	if (!evoice) {
		return new Handlebars.SafeString(ovoice);
	}
	if (!evoice) {
		evoice = "";
	}
	evoice = evoice.replace(/\s*\+\s*/g, "+");
	if (evoice.match(/alfabeto/)) {
		evoice = evoice.replace(/\s*\+?\s*alfabeto/, "");
	}
	if (evoice === ovoice) {
		return new Handlebars.SafeString(ovoice);
	}
	evoice = evoice.replace(/b\.?c\.?/gi, "bc");
	ovoice = ovoice.replace(/b\.?c\.?/gi, "bc");
	if (ovoice.match(/b\.?c\.?/i) && evoice.match(/b\.?c\.?/i)) {
		evoice = evoice.replace(/\s*\+?\s*b\.?c\.?/i, "");
	}
	var text = ovoice + "(" + evoice + ")";
	return new Handlebars.SafeString(text);
});

</script>




